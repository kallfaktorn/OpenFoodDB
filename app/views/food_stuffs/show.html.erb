
  <br />
  <br />
  <br />

  <div class="container">

  <br />
  <br />
  <br />
  
  <div align="center" style="margin-left:-445px;">
    <% if @food_stuff.logo.exists? %>
      <%= image_tag @food_stuff.logo.url(:medium) %>
    <% end %>
  </div>
  
  <br />
  

  <div class="hero-unit">

    <table class="informationTable">
      <tr>
        <th class="informationTH">Information </th>
      </tr>

      <% @audit_thumbs_up.each do |a| %>
        <%= link_to image_tag('thumb_up_green.jpg', :border => 0), vote_up_food_stuff_path( :id => a.audit_id), :remote => true, :id => "thumbs_up" + a.audit_id.to_s, :class => "thumbs_up" %>
        <%= label_tag 'votes_id', AuditThumbsUp.find_by_audit_id(a.audit_id).votes_for, :id => 'votes_id' + a.audit_id.to_s, :class => "thumbs_up" %>
      <% end %>

      <% if @food_stuff.name.blank? == false %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
            <%= t(:FoodStuff_Name) + ": " %>
            <%= label_tag 'name', @food_stuff.name, :id => "name_id", :class => "auditable" %>
          <% end %>
        <% end %>
      <% end %>

      <% if @food_stuff.bar_code_number.blank? == false %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
            <%= t(:FoodStuff_Bar_Code) + ": " %>
            <%= label_tag 'bar_code_number', @food_stuff.bar_code_number, :id => "bar_code_number_id", :class => "auditable" %>
          <% end %>
        <% end %>
      <% end %>

      <% if @food_stuff.ingredients.length > 0 %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
            <%= t(:FoodStuff_Ingredients) + ": " %>
            <%= label_tag 'ingredients', @food_stuff.ingredients_field, :id => "ingredients_field_id", :class => "auditable" %>
          <% end %>
        <% end %>
      <% end %>

      <% if @food_stuff.retailers.length > 0 %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
          <%= "Retailers: " %>
          <%= label_tag 'retailers', @food_stuff.retailers_field, :id => "retailers_field_id", :class => "auditable" %>
          <% end %>
        <% end %>
      <% end %>

      <% if @food_stuff.vendor.blank? == false %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
          <%= t(:FoodStuff_Vendor) + ": " %>
          <%= label_tag 'vendor', @food_stuff.vendor, :id => "vendor_id", :class => "auditable" %>
          <% end %>
        <% end %>
      <% end %>
      
      <% if @food_stuff.expiration_date_unopened.blank? == false %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
            <%= t(:FoodStuff_Expiration_Unopened) + ": " %>
            <%= label_tag 'expiration_date_unopened', @food_stuff.expiration_date_unopened, :id => "expiration_date_unopened_id", :class => "auditable" %>
            <%= " " + t(:FoodStuff_Days) %>
          <% end %>
        <% end %>
      <% end %>
      
      <% if @food_stuff.expiration_date_broached.blank? == false %>
        <%= content_tag :tr, :class => "InformationTableRow" do %>
          <%= content_tag :td, :class => "informationTD", :align => "left" do %>
            <%= t(:FoodStuff_Expiration_Broached) + ": " %>
            <%= label_tag 'expiration_date_broached', @food_stuff.expiration_date_broached, :id => "expiration_date_broached_id", :class => "auditable" %>
            <%= " " + t(:FoodStuff_Days) %>
          <% end %>
        <% end %>
      <% end %>
    </table>
  
    <br />
    <br />
    <br />
    
    <table class="nutritionTable">
      <tr>
        <th class="nutritionTH"><%= t(:FoodStuff_Table_Header_Nutrient) %></th>
        <th class="nutritionTH"><%= t(:FoodStuff_Table_Header_Amount) %></th>
        <th class="nutritionTH"><%= t(:FoodStuff_Table_Header_Unit) %></th>
      </tr>
      <%= render :partial => 'tr', :locals => {:id => "energy_kcal_id", :nutrient => t(:FoodStuff_Energy_kcal), :amount => @food_stuff.energy_kcal, :unit => "kcal" } %>
      <%= render :partial => 'tr', :locals => {:id => "energy_kj_id", :nutrient => t(:FoodStuff_Energy_kj), :amount => @food_stuff.energy_kj, :unit => "kj" } %>
      <%= render :partial => 'tr', :locals => {:id => "protein_id", :nutrient => t(:FoodStuff_Protein), :amount => @food_stuff.protein, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fat_id", :nutrient => t(:FoodStuff_Fat), :amount => @food_stuff.fat, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "carbohydrates_id", :nutrient => t(:FoodStuff_Carbohydrates), :amount => @food_stuff.carbohydrates, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fibers_id", :nutrient => t(:FoodStuff_Fibers), :amount => @food_stuff.fibers, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "salt_id", :nutrient => t(:FoodStuff_Salt), :amount => @food_stuff.salt, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "ash_id", :nutrient => t(:FoodStuff_Ash), :amount => @food_stuff.ash, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "water_id", :nutrient => t(:FoodStuff_Water), :amount => @food_stuff.water, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "alcohol_id", :nutrient => t(:FoodStuff_Alcohol), :amount => @food_stuff.alcohol, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "monosaccharides_id", :nutrient => t(:FoodStuff_Monosaccharides), :amount => @food_stuff.monosaccharides, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "disaccharides_id", :nutrient => t(:FoodStuff_Disaccharides), :amount => @food_stuff.disaccharides, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "sackaros_id", :nutrient => t(:FoodStuff_Sackaros), :amount => @food_stuff.sackaros, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "lactose_id", :nutrient => t(:FoodStuff_Lactose), :amount => @food_stuff.lactose, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "whole_grain_total_id", :nutrient => t(:FoodStuff_Whole_grain_total), :amount => @food_stuff.whole_grain_total, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "total_saturated_fatty_acids_id", :nutrient => t(:FoodStuff_Total_saturated_fatty_acids), :amount => @food_stuff.total_saturated_fatty_acids, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_40_100_id", :nutrient => t(:FoodStuff_Fatty_acid_40_100), :amount => @food_stuff.fatty_acid_40_100, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_120_id", :nutrient => t(:FoodStuff_Fatty_acid_120), :amount => @food_stuff.fatty_acid_120, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_140_id", :nutrient => t(:FoodStuff_Fatty_acid_140), :amount => @food_stuff.fatty_acid_140, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_160_id", :nutrient => t(:FoodStuff_Fatty_acid_160), :amount => @food_stuff.fatty_acid_160, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_180_id", :nutrient => t(:FoodStuff_Fatty_acid_180), :amount => @food_stuff.fatty_acid_180, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_200_id", :nutrient => t(:FoodStuff_Fatty_acid_200), :amount => @food_stuff.fatty_acid_200, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "total_monounsaturated_fatty_acids_id", :nutrient => t(:FoodStuff_Total_monounsaturated_fatty_acids), :amount => @food_stuff.total_monounsaturated_fatty_acids, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_161_id", :nutrient => t(:FoodStuff_Fatty_acid_161), :amount => @food_stuff.fatty_acid_161, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_181_id", :nutrient => t(:FoodStuff_Fatty_acid_181), :amount => @food_stuff.fatty_acid_181, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "total_polyunsaturated_fatty_acids_id", :nutrient => t(:FoodStuff_Total_polyunsaturated_fatty_acids), :amount => @food_stuff.total_polyunsaturated_fatty_acids, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "total_n6_fatty_acids_id", :nutrient => t(:FoodStuff_Total_n6_fatty_acids), :amount => @food_stuff.total_n6_fatty_acids, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_182_id", :nutrient => t(:FoodStuff_Fatty_acid_182), :amount => @food_stuff.fatty_acid_182, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_204_id", :nutrient => t(:FoodStuff_Fatty_acid_204), :amount => @food_stuff.fatty_acid_204, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "total_n3_fatty_acids_id", :nutrient => t(:FoodStuff_Total_n3_fatty_acids), :amount => @food_stuff.total_n3_fatty_acids, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "fatty_acid_183_id", :nutrient => t(:FoodStuff_Fatty_acid_183), :amount => @food_stuff.fatty_acid_183, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "EPA_fatty_acid_205_id", :nutrient => t(:FoodStuff_EPA_Fatty_acid_205), :amount => @food_stuff.EPA_fatty_acid_205, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "DPA_fatty_acid_225_id", :nutrient => t(:FoodStuff_DPA_Fatty_acid_225), :amount => @food_stuff.DPA_fatty_acid_225, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "DHA_fatty_acid_226_id", :nutrient => t(:FoodStuff_DHA_Fatty_acid_226), :amount => @food_stuff.DHA_fatty_acid_226, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "total_trans_fatty_acids_id", :nutrient => t(:FoodStuff_Total_trans_fatty_acids), :amount => @food_stuff.total_trans_fatty_acids, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "cholesterol_id", :nutrient => t(:FoodStuff_Cholesterol), :amount => @food_stuff.cholesterol, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "retinol_equivalents_id", :nutrient => t(:FoodStuff_Retinol_equivalents), :amount => @food_stuff.retinol_equivalents, :unit => "g" } %>
      <%= render :partial => 'tr', :locals => {:id => "retinol_id", :nutrient => t(:FoodStuff_Retinol), :amount => @food_stuff.retinol, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "beta_carotene_id", :nutrient => t(:FoodStuff_Beta_Carotene), :amount => @food_stuff.beta_carotene, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "vitamin_d_id", :nutrient => t(:FoodStuff_Vitamin_D), :amount => @food_stuff.vitamin_d, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "vitamin_e_id", :nutrient => t(:FoodStuff_Vitamin_E), :amount => @food_stuff.vitamin_e, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "vitamin_k_id", :nutrient => t(:FoodStuff_Vitamin_K), :amount => @food_stuff.vitamin_k, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "thiamine_id", :nutrient => t(:FoodStuff_Thiamine), :amount => @food_stuff.thiamine, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "riboflavin_id", :nutrient => t(:FoodStuff_Riboflavin), :amount => @food_stuff.riboflavin, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "vitamin_c_id", :nutrient => t(:FoodStuff_Vitamin_C), :amount => @food_stuff.vitamin_c, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "niacin_id", :nutrient => t(:FoodStuff_Niacin), :amount => @food_stuff.niacin, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "niacin_equivalents_id", :nutrient => t(:FoodStuff_Niacin_equivalents), :amount => @food_stuff.niacin_equivalents, :unit => "" } %>
      <%= render :partial => 'tr', :locals => {:id => "vitamin_b6_id", :nutrient => t(:FoodStuff_Vitamin_B6), :amount => @food_stuff.vitamin_b6, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "vitamin_b12_id", :nutrient => t(:FoodStuff_Vitamin_B12), :amount => @food_stuff.vitamin_b12, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "folate_id", :nutrient => t(:FoodStuff_Folate), :amount => @food_stuff.folate, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "phosphorus_id", :nutrient => t(:FoodStuff_Phosphorus), :amount => @food_stuff.phosphorus, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "iodine_id", :nutrient => t(:FoodStuff_Iodine), :amount => @food_stuff.iodine, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "iron_id", :nutrient => t(:FoodStuff_Iron), :amount => @food_stuff.iron, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "calcium_id", :nutrient => t(:FoodStuff_Calcium), :amount => @food_stuff.calcium, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "potassium_id", :nutrient => t(:FoodStuff_Potassium), :amount => @food_stuff.potassium, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "magnesium_id", :nutrient => t(:FoodStuff_Magnesium), :amount => @food_stuff.magnesium, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "sodium_id", :nutrient => t(:FoodStuff_Sodium), :amount => @food_stuff.sodium, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "selenium_id", :nutrient => t(:FoodStuff_Selenium), :amount => @food_stuff.selenium, :unit => "µg" } %>
      <%= render :partial => 'tr', :locals => {:id => "zinc_id", :nutrient => t(:FoodStuff_Zinc), :amount => @food_stuff.zinc, :unit => "mg" } %>
      <%= render :partial => 'tr', :locals => {:id => "waste_id", :nutrient => t(:FoodStuff_Waste), :amount => @food_stuff.waste, :unit => "" } %>
    </table>
  
    <br />
  
  
    <div align="left" style="margin-left:252px;">
      <% if @food_stuff.food_stuff_image.exists? %>
        <%= image_tag @food_stuff.food_stuff_image.url(:thumb) %><br />
      <% end %>
    </div>
  
  

  </div>
  
  <br />
  <br />


  <br />
  <br />

  <% @food_stuff_marks.each do |mark| %>
    <% if mark_in_foodstuff(mark.name, @food_stuff.mark_names) %>
      <%= image_tag mark.food_stuff_mark_image.url(:thumb) %>
    <% end %>
  <% end %>

  <br />
  <br />


  <br />
  <br />


  <%= render :partial => 'comment', :collection => @food_stuff.comments %>

  <% if current_user != nil %>
    <%= form_for([@food_stuff, @food_stuff.comments.build]) do |f| %>
      <%= f.hidden_field :food_stuff_id %>

      <div class="field">
        <%= f.label t(:FoodStuff_Comment_Label_Title) %><br />
        <%= f.text_area :body, :style => "width:550px"%>
      </div>

      <div class="actions">
        <%= f.submit t(:FoodStuff_Show_Button_Post_Comment), :class => 'custom_button' %>
      </div>
    <% end %>
  <% end %>

  <div align="left" style="margin-left:242px;">
    <%= link_to t(:Button_Edit), edit_food_stuff_path(@food_stuff) %> |
    <%= link_to t(:Button_Back), :back %>
  </div>



  <div id="footer">
    <div id="slideout">
      <%= image_tag "slider_more.png", :id => "slideout_image_more", :class => "more_anchors", :hidden => "hidden" %>
      <%= image_tag "slider_less.png", :id => "slideout_image_less", :class => "more_anchors", :hidden => "hidden" %>

      <div class="history"></div>

      <div id="slideout_inner">

        <a id="history_anchor" class="more_anchors" onclick="javascript:history()">History</a>
        <a class="more_anchors">Tags</a>
      </div>
    </div>
  </div>


</div>




<script id="food_stuff_json" type="text/json">
  <%= raw @food_stuff.to_json %>
</script>

<script id="audits_json" type="text/json">
  <%= raw @audits.to_json %>
</script>

<script id="audit_thumbs_up_json" type="text/json">
  <%= raw @audit_thumbs_up.to_json %>
</script>



<script type="text/javascript">

  var foodStuffJSON = $("#food_stuff_json").html();
  var foodStuff     = $.parseJSON(foodStuffJSON);

  var auditsJSON = $("#audits_json").html();
  var audits     = $.parseJSON(auditsJSON);

  var history_hidden = true;

  var thumb_up_ids = new Array();
  var votes_ids = new Array();
  
  var slideIsOut = false;
  var animationTime = 100;
  
  for(i in audits) {
    
    var id = audits[i].id;
    
    (function() {
      var thumb_up_id = "#thumbs_up" + id;
      var votes_id = "#votes_id" + id;
    
      $(thumb_up_id).bind('ajax:success', function(evt, data) {
        $(votes_id).text(data);
      });  
    }());
  }

  $(document).ready(function() {

    $(".thumbs_up").hide();

    if(audits[audits.length - 1] != null)
    {
      var last_id = audits[audits.length - 1].id;

      var thumb_up_id = "#thumbs_up" + last_id;
      $(thumb_up_id).show();

      var votes_id = "#votes_id" + last_id;
      $(votes_id).show();

      $('#votes_id').text(audits[i]);
    }

    var i = 0;
    $("tr").each(function( j ) {

      i = (i + 1) % 2;
      var d = 'd' + i;
      var e = 'e' + i;

      if($(this).attr('class') == "NutritionTableRow")
        $(this).attr('class', "NutritionTableRow " + d);

      if($(this).attr('class') == "InformationTableRow")
        $(this).attr('class', "InformationTableRow " + e);
    });

    var history_div = $('.history');

    for(var i in audits) {

      var id = "_" + audits[i].id;
      var history_anchor = "<pre><div class='history_item' id='history" + id + "'" + "onclick='javascript:history_click(" + audits[i].id + ")'" + ">" + audits[i].created_at + "</div></pre>";
      history_div.append(history_anchor.replace("T", " ").replace("Z", ""));

      var history_data = "<div hidden='hidden' id='history" + id + "_d" + "'" + ">" + audits[i].id + "</div>";
      history_div.append(history_data);
    }

    $('.history').hide();
    
    $('#slideout_image_more').show();
    $('#slideout_image_less').hide();

  });
  
  $('#slideout_image_more').click(function() {

      $('#slideout').animate({right: '90'}, animationTime, function() {});

      $('#slideout_inner').animate({
        right: '0'
      }, animationTime, function() {

        $('#slideout_image_more').hide();
        $('#slideout_image_less').show();
      });
  });

  $('#slideout_image_less').click(function() {

      $('.history').hide();
      history_hidden = true;

      $('#slideout').animate({right: '0'}, animationTime, function() {});

      $('#slideout_inner').animate({
        right: '-150'
      }, animationTime, function() {
      
        $('#slideout_image_more').show();
        $('#slideout_image_less').hide();
      });
  });

  function history() 
  {
    if( history_hidden == false )
    {
      $('.history').hide();
      history_hidden = true;
    }
    else
    {
      $('.history').show();
      history_hidden = false;
    }
  }

  function history_reset()
  {
    $(".auditable").text(null);
  }

  function history_click(id)
  {
    history_reset();

    $(".thumbs_up").hide();

    for(var i in audits)
    {
      var audit = audits[i];

      for(var j in audit.audited_changes)
      {
        var change = audit.audited_changes[j];
        
        var column_id = "#" + j + "_id";

        if(change != null) {

          if(typeof change === 'string' || typeof change === 'number') {
            $(column_id).text(change);
          }
          else {
            $(column_id).text(change[1]);
          }
        }
      }

      if(audits[i].id == id)
      {
        break;
      }
    }

    var thumb_up_id = "#thumbs_up" + id;
    $(thumb_up_id).show();

    var votes_id = "#votes_id" + id;
    $(votes_id).show();
  }

</script>